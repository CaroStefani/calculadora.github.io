<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Calculadora de Concentraciones para Todos</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif; /* Fuente amigable */
      margin: 20px;
      background-color: #f0f8ff; /* Fondo azul claro suave */
      color: #333;
      text-align: center;
    }

    h1, h2, h3, h4, h5 {
      margin-top: 0.5em;
      color: #333;
    }

    /* Estilo para las secciones con bordes redondeados y colores pastel */
    .section {
      margin: 10px auto;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #ddd;
      background: #fff;
      max-width: 500px;
      text-align: left;
      box-shadow: 2px 2px 12px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
      cursor: pointer;
    }

    input, select, button {
      margin-top: 5px;
      padding: 8px;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      width: auto;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      margin-top: 15px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    .result {
      background: #e0f7fa; /* Azul pastel */
      border: 2px solid #81d4fa;
      padding: 15px;
      margin-top: 20px;
      border-radius: 10px;
      text-align:center;
      font-size: 1.2em;
    }

    .history {
      list-style: none;
      padding: 0;
    }

    .history li {
      background: #fff9c4; /* Amarillo pastel */
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #fdd835;
      text-align:center;
      font-size: 0.9em;
    }

    .conversion-panel {
      margin-top: 20px;
    }

    .tutorial-step {
      background: #f1f8e9; /* Verde claro */
      border: 1px solid #c5e1a5;
      margin-bottom:10px;
      padding: 10px;
      border-radius: 5px;
      font-size: 0.95em;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .footer-message {
      margin-top: 30px;
      text-align: center;
      color: #555;
      font-style: italic;
    }

    /* Tooltip container */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      color: #2196F3;
      margin-left: 5px;
    }

    /* Tooltip text */
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 220px;
      background-color: #555;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%; /* Position above */
      left: 50%;
      margin-left: -110px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    /* Tooltip arrow */
    .tooltip .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%; /* At the bottom of tooltip */
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: #555 transparent transparent transparent;
    }

    /* Show tooltip on hover */
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>üß™ Calculadora de Concentraciones para Todos üß™</h1>

  <!-- Secci√≥n para seleccionar el tipo de c√°lculo con icono y explicaci√≥n -->
  <div class="section">
    <label for="calcType">üîç <strong>¬øQu√© quieres calcular?</strong>
      <span class="tooltip">‚ùì
        <span class="tooltiptext">
          Selecciona el tipo de concentraci√≥n que deseas calcular. Cada tipo tiene una f√≥rmula diferente con ejemplos pr√°cticos.
        </span>
      </span>
    </label>
    <select id="calcType" aria-label="Tipo de c√°lculo">
      <option value="percent_m_m">% m/m (Porcentaje masa/masa)</option>
      <option value="percent_m_v">% m/v (Porcentaje masa/volumen)</option>
      <option value="percent_v_v">% v/v (Porcentaje volumen/volumen)</option>
      <option value="ppm">PPM (Partes por mill√≥n)</option>
      <option value="molarity">M (Molaridad)</option>
      <option value="normality">N (Normalidad)</option>
      <option value="mole_fraction">X (Fracci√≥n molar)</option>
    </select>
  </div>

  <!-- Secci√≥n de tutorial interactivo -->
  <div id="tutorial" class="section" aria-live="polite">
    <!-- Los pasos del tutorial se agregar√°n aqu√≠ din√°micamente -->
  </div>

  <h2>üì• Datos de Entrada üì•</h2>
  <div id="inputFields" class="section">
    <!-- Los campos de entrada se agregar√°n aqu√≠ din√°micamente -->
  </div>

  <button id="calcButton">‚úÖ ¬°Calcular!</button>

  <!-- Contenedor para mostrar el resultado -->
  <div id="resultContainer"></div>

  <!-- Panel de conversi√≥n de unidades -->
  <div class="section conversion-panel">
    <h2>üîÑ Conversi√≥n de Unidades üîÑ</h2>
    <div class="flex-row">
      <div>
        <label for="convertValue">üìè Valor:
          <span class="tooltip">‚ùì
            <span class="tooltiptext">
              Ingresa el n√∫mero que deseas convertir de una unidad a otra.
            </span>
          </span>
        </label>
        <input type="number" id="convertValue" placeholder="Ingresa un n√∫mero"/>
      </div>
      <div>
        <label for="fromUnit">üîÄ De:
          <span class="tooltip">‚ùì
            <span class="tooltiptext">
              Selecciona la unidad actual del valor que deseas convertir.
            </span>
          </span>
        </label>
        <select id="fromUnit">
          <option>gramos (g)</option>
          <option>kilogramos (kg)</option>
          <option>litros (L)</option>
          <option>mililitros (mL)</option>
        </select>
      </div>
      <div>
        <label for="toUnit">‚û°Ô∏è A:
          <span class="tooltip">‚ùì
            <span class="tooltiptext">
              Selecciona la unidad a la que deseas convertir el valor.
            </span>
          </span>
        </label>
        <select id="toUnit">
          <option>gramos (g)</option>
          <option>kilogramos (kg)</option>
          <option>litros (L)</option>
          <option>mililitros (mL)</option>
        </select>
      </div>
    </div>
    <button id="convertButton">üîÑ Convertir</button>
    <div id="conversionResult" class="result"></div>
  </div>

  <h2>üïí √öltimo C√°lculo Realizado üïí</h2>
  <ul class="history" id="historyList">
    <!-- Historial se mostrar√° aqu√≠ -->
  </ul>

  <p class="footer-message">‚ú® Creado con amor por Daniela Torreblanca y Carolina Mart√≠nez ‚ú®</p>

  <script>
    // Tutoriales simplificados con ejemplos pr√°cticos para cada tipo de c√°lculo
    const tutorialSteps = {
      "percent_m_m": [
        "1Ô∏è‚É£ Selecciona % m/m.",
        "2Ô∏è‚É£ Escribe cu√°nto pesa la sustancia que est√°s usando (en gramos).",
        "3Ô∏è‚É£ Escribe el peso total de la soluci√≥n (en gramos).",
        "üí° **Ejemplo:** Si tienes 30 gramos de cacao en 100 gramos de chocolate, el % m/m de cacao es (30/100) √ó 100 = 30%."
      ],
      "percent_m_v": [
        "1Ô∏è‚É£ Selecciona % m/v.",
        "2Ô∏è‚É£ Escribe cu√°nto pesa la sustancia (en gramos).",
        "3Ô∏è‚É£ Escribe el volumen de la soluci√≥n (en mililitros).",
        "üí° **Ejemplo:** Si disuelves 10 gramos de az√∫car en 100 mililitros de agua, el % m/v de az√∫car es (10/100) √ó 100 = 10%."
      ],
      "percent_v_v": [
        "1Ô∏è‚É£ Selecciona % v/v.",
        "2Ô∏è‚É£ Escribe el volumen de la sustancia (en mililitros).",
        "3Ô∏è‚É£ Escribe el volumen total de la soluci√≥n (en mililitros).",
        "üí° **Ejemplo:** Si mezclas 50 mL de jugo de naranja con 150 mL de agua, el % v/v de jugo es (50/200) √ó 100 = 25%."
      ],
      "ppm": [
        "1Ô∏è‚É£ Selecciona PPM.",
        "2Ô∏è‚É£ Escribe cu√°nto pesa la sustancia (en gramos).",
        "3Ô∏è‚É£ Escribe el peso total de la soluci√≥n (en gramos).",
        "üí° **Ejemplo:** Si tienes 0.05 gramos de contaminante en 1000 gramos de agua, el PPM es (0.05/1000) √ó 1,000,000 = 50 ppm."
      ],
      "molarity": [
        "1Ô∏è‚É£ Selecciona Molaridad (M).",
        "2Ô∏è‚É£ Escribe los moles de la sustancia.",
        "3Ô∏è‚É£ Escribe el volumen de la soluci√≥n (en litros).",
        "üí° **Ejemplo:** Si disuelves 1 mol de sal en 2 litros de agua, la molaridad es 1/2 = 0.5 M."
      ],
      "normality": [
        "1Ô∏è‚É£ Selecciona Normalidad (N).",
        "2Ô∏è‚É£ Escribe los equivalentes de la sustancia.",
        "3Ô∏è‚É£ Escribe el volumen de la soluci√≥n (en litros).",
        "üí° **Ejemplo:** Si tienes 1 equivalente de √°cido en 1 litro de soluci√≥n, la normalidad es 1 N."
      ],
      "mole_fraction": [
        "1Ô∏è‚É£ Selecciona Fracci√≥n molar (X).",
        "2Ô∏è‚É£ Escribe los moles de la sustancia.",
        "3Ô∏è‚É£ Escribe los moles del solvente.",
        "üí° **Ejemplo:** Si tienes 1 mol de alcohol y 9 moles de agua, la fracci√≥n molar del alcohol es 1 / (1 + 9) = 0.1."
      ]
    };

    // Campos de entrada din√°micos seg√∫n el tipo de c√°lculo con ejemplos pr√°cticos
    function getInputFields(type) {
      switch(type) {
        case "percent_m_m":
          return `
            <label for="massSoluto">üß¥ Masa de la sustancia (g):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el peso de la sustancia que est√°s usando. <br>**Ejemplo:** 30 gramos de cacao.
                </span>
              </span>
            </label>
            <input type="number" id="massSoluto" placeholder="Ej: 30"/>
            <label for="massTotal">‚öñÔ∏è Masa total de la soluci√≥n (g):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el peso total de la soluci√≥n. <br>**Ejemplo:** 100 gramos de chocolate.
                </span>
              </span>
            </label>
            <input type="number" id="massTotal" placeholder="Ej: 100"/>
          `;
        case "percent_m_v":
          return `
            <label for="massSoluto">üß¥ Masa de la sustancia (g):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el peso de la sustancia que est√°s disolviendo. <br>**Ejemplo:** 10 gramos de az√∫car.
                </span>
              </span>
            </label>
            <input type="number" id="massSoluto" placeholder="Ej: 10"/>
            <label for="volumeSolution">üíß Volumen de la soluci√≥n (mL):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el volumen total de la soluci√≥n. <br>**Ejemplo:** 100 mililitros de agua.
                </span>
              </span>
            </label>
            <input type="number" id="volumeSolution" placeholder="Ej: 100"/>
          `;
        case "percent_v_v":
          return `
            <label for="volumeSoluto">üíß Volumen de la sustancia (mL):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el volumen de la sustancia que est√°s mezclando. <br>**Ejemplo:** 50 mL de jugo de naranja.
                </span>
              </span>
            </label>
            <input type="number" id="volumeSoluto" placeholder="Ej: 50"/>
            <label for="volumeTotal">üíß Volumen total de la soluci√≥n (mL):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el volumen total de la soluci√≥n. <br>**Ejemplo:** 200 mililitros de mezcla.
                </span>
              </span>
            </label>
            <input type="number" id="volumeTotal" placeholder="Ej: 200"/>
          `;
        case "ppm":
          return `
            <label for="massSoluto">üß¥ Masa de la sustancia (g):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el peso de la sustancia en partes por mill√≥n. <br>**Ejemplo:** 0.05 gramos de contaminante.
                </span>
              </span>
            </label>
            <input type="number" id="massSoluto" placeholder="Ej: 0.05"/>
            <label for="massTotal">‚öñÔ∏è Masa total de la soluci√≥n (g):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el peso total de la soluci√≥n. <br>**Ejemplo:** 1000 gramos de agua.
                </span>
              </span>
            </label>
            <input type="number" id="massTotal" placeholder="Ej: 1000"/>
          `;
        case "molarity":
          return `
            <label for="molesSoluto">üî¨ Moles de la sustancia (mol):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa la cantidad de moles de la sustancia. <br>**Ejemplo:** 1 mol de sal.
                </span>
              </span>
            </label>
            <input type="number" id="molesSoluto" placeholder="Ej: 1"/>
            <label for="volumeSolution">üíß Volumen de la soluci√≥n (L):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el volumen total de la soluci√≥n en litros. <br>**Ejemplo:** 2 litros de agua.
                </span>
              </span>
            </label>
            <input type="number" id="volumeSolution" placeholder="Ej: 2"/>
          `;
        case "normality":
          return `
            <label for="equivalentes">üî¨ Equivalentes de la sustancia:
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa los equivalentes de la sustancia. <br>**Ejemplo:** 1 equivalente de √°cido.
                </span>
              </span>
            </label>
            <input type="number" id="equivalentes" placeholder="Ej: 1"/>
            <label for="volumeSolution">üíß Volumen de la soluci√≥n (L):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa el volumen total de la soluci√≥n en litros. <br>**Ejemplo:** 1 litro de soluci√≥n.
                </span>
              </span>
            </label>
            <input type="number" id="volumeSolution" placeholder="Ej: 1"/>
          `;
        case "mole_fraction":
          return `
            <label for="molesSoluto">üî¨ Moles de la sustancia (mol):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa la cantidad de moles de la sustancia. <br>**Ejemplo:** 1 mol de alcohol.
                </span>
              </span>
            </label>
            <input type="number" id="molesSoluto" placeholder="Ej: 1"/>
            <label for="molesSolvente">üî¨ Moles del solvente (mol):
              <span class="tooltip">‚ùì
                <span class="tooltiptext">
                  Ingresa la cantidad de moles del solvente. <br>**Ejemplo:** 9 moles de agua.
                </span>
              </span>
            </label>
            <input type="number" id="molesSolvente" placeholder="Ej: 9"/>
          `;
        default:
          return "";
      }
    }

    // Funci√≥n para realizar los c√°lculos con explicaciones pr√°cticas
    function calculate(type, inputs) {
      let result = null;
      let explanation = "";
      const n = Number;

      switch(type) {
        case "percent_m_m":
          if (inputs.massSoluto && inputs.massTotal) {
            const val = (n(inputs.massSoluto)/n(inputs.massTotal))*100;
            result = val.toFixed(2) + " % m/m";
            explanation = "Porcentaje masa/masa = (masa de la sustancia / masa total) √ó 100.";
          }
          break;
        case "percent_m_v":
          if (inputs.massSoluto && inputs.volumeSolution) {
            const val = (n(inputs.massSoluto)/n(inputs.volumeSolution))*100;
            result = val.toFixed(2) + " % m/v";
            explanation = "Porcentaje masa/volumen = (masa de la sustancia / volumen de la soluci√≥n) √ó 100.";
          }
          break;
        case "percent_v_v":
          if (inputs.volumeSoluto && inputs.volumeTotal) {
            const val = (n(inputs.volumeSoluto)/n(inputs.volumeTotal))*100;
            result = val.toFixed(2) + " % v/v";
            explanation = "Porcentaje volumen/volumen = (volumen de la sustancia / volumen total) √ó 100.";
          }
          break;
        case "ppm":
          if (inputs.massSoluto && inputs.massTotal) {
            const val = (n(inputs.massSoluto)/n(inputs.massTotal))*1_000_000;
            result = val.toFixed(2) + " ppm";
            explanation = "PPM = (masa de la sustancia / masa total) √ó 1,000,000.";
          }
          break;
        case "molarity":
          if (inputs.molesSoluto && inputs.volumeSolution) {
            const val = n(inputs.molesSoluto)/n(inputs.volumeSolution);
            result = val.toFixed(2) + " M";
            explanation = "Molaridad (M) = moles de la sustancia / volumen de la soluci√≥n (L).";
          }
          break;
        case "normality":
          if (inputs.equivalentes && inputs.volumeSolution) {
            const val = n(inputs.equivalentes)/n(inputs.volumeSolution);
            result = val.toFixed(2) + " N";
            explanation = "Normalidad (N) = equivalentes de la sustancia / volumen de la soluci√≥n (L).";
          }
          break;
        case "mole_fraction":
          if (inputs.molesSoluto && inputs.molesSolvente) {
            const val = n(inputs.molesSoluto)/(n(inputs.molesSoluto)+n(inputs.molesSolvente));
            result = val.toFixed(4);
            explanation = "Fracci√≥n molar (X) = moles de la sustancia / (moles de la sustancia + moles del solvente).";
          }
          break;
      }

      return {result, explanation};
    }

    // Manejo de historial en localStorage
    function loadHistory() {
      let hist = localStorage.getItem("lastCalculation");
      return hist ? JSON.parse(hist) : null;
    }

    function saveHistory(entry) {
      // Guardamos s√≥lo el √∫ltimo c√°lculo
      localStorage.setItem("lastCalculation", JSON.stringify(entry));
    }

    function updateHistoryUI() {
      const h = loadHistory();
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      if (h) {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${getCalcLabel(h.type)}</strong> (${h.date})<br><em>Entradas:</em> ${formatInputs(h.inputs)}<br><em>Resultado:</em> ${h.result}`;
        list.appendChild(li);
      }
    }

    function getCalcLabel(type) {
      const labels = {
        "percent_m_m": "% m/m",
        "percent_m_v": "% m/v",
        "percent_v_v": "% v/v",
        "ppm": "PPM",
        "molarity": "M (Molaridad)",
        "normality": "N (Normalidad)",
        "mole_fraction": "X (Fracci√≥n molar)"
      };
      return labels[type] || type;
    }

    function formatInputs(inputs) {
      let formatted = "";
      for (const key in inputs) {
        let label = "";
        switch(key) {
          case "massSoluto": label = "Masa de la sustancia (g)"; break;
          case "massTotal": label = "Masa total de la soluci√≥n (g)"; break;
          case "volumeSolution": label = "Volumen de la soluci√≥n (mL o L)"; break;
          case "volumeSoluto": label = "Volumen de la sustancia (mL)"; break;
          case "volumeTotal": label = "Volumen total de la soluci√≥n (mL)"; break;
          case "molesSoluto": label = "Moles de la sustancia (mol)"; break;
          case "equivalentes": label = "Equivalentes de la sustancia"; break;
          case "molesSolvente": label = "Moles del solvente (mol)"; break;
          default: label = key;
        }
        formatted += `${label}: ${inputs[key]}<br>`;
      }
      return formatted;
    }

    function showTutorial(type) {
      const container = document.getElementById("tutorial");
      container.innerHTML = "";
      if (tutorialSteps[type]) {
        const title = document.createElement("h3");
        title.textContent = "üìö Tutorial Paso a Paso üìö";
        container.appendChild(title);
        tutorialSteps[type].forEach((step, i) => {
          const div = document.createElement("div");
          div.className = "tutorial-step";
          div.innerHTML = step;
          container.appendChild(div);
        });
      }
    }

    // Conversi√≥n simple de unidades con validaciones amigables
    function convertUnits(val, fromU, toU) {
      let number = parseFloat(val);
      if (isNaN(number)) return "‚ùå Valor inv√°lido.";

      // Conversiones de masa
      if (fromU === "kilogramos (kg)" && toU === "gramos (g)") {
        return `${number} kg = ${number * 1000} g`;
      }
      if (fromU === "gramos (g)" && toU === "kilogramos (kg)") {
        return `${number} g = ${(number / 1000).toFixed(3)} kg`;
      }

      // Conversiones de volumen
      if (fromU === "litros (L)" && toU === "mililitros (mL)") {
        return `${number} L = ${number * 1000} mL`;
      }
      if (fromU === "mililitros (mL)" && toU === "litros (L)") {
        return `${number} mL = ${(number / 1000).toFixed(3)} L`;
      }

      // Mismas unidades
      if (fromU === toU) {
        return "‚ÑπÔ∏è Las unidades son iguales.";
      }

      // Conversiones no definidas
      return "‚ö†Ô∏è Conversi√≥n no definida entre estas unidades.";
    }

    // Inicializaci√≥n y manejo de eventos
    document.addEventListener("DOMContentLoaded", () => {
      const calcTypeSelect = document.getElementById("calcType");
      const inputFieldsContainer = document.getElementById("inputFields");
      const calcButton = document.getElementById("calcButton");
      const resultContainer = document.getElementById("resultContainer");
      const convertButton = document.getElementById("convertButton");

      function updateUI() {
        const type = calcTypeSelect.value;
        inputFieldsContainer.innerHTML = getInputFields(type);
        showTutorial(type);
        resultContainer.innerHTML = "";
      }

      calcTypeSelect.addEventListener("change", updateUI);

      calcButton.addEventListener("click", () => {
        const type = calcTypeSelect.value;
        // Tomar inputs
        const inputs = {};
        const fields = inputFieldsContainer.querySelectorAll("input");
        fields.forEach(f => {
          inputs[f.id] = f.value;
        });

        const {result, explanation} = calculate(type, inputs);
        if (result) {
          resultContainer.innerHTML = `
            <div class="result">
              <h3>‚úÖ Resultado</h3>
              <p>${result}</p>
              <p><strong>üìù Explicaci√≥n:</strong> ${explanation}</p>
            </div>
          `;
          const entry = {
            type: type,
            inputs: inputs,
            result: result,
            date: new Date().toLocaleString()
          };
          saveHistory(entry);
          updateHistoryUI();
        } else {
          resultContainer.innerHTML = `<div class="result">‚ö†Ô∏è Por favor, completa todos los campos requeridos.</div>`;
        }
      });

      convertButton.addEventListener("click", () => {
        const val = document.getElementById("convertValue").value;
        const fromU = document.getElementById("fromUnit").value;
        const toU = document.getElementById("toUnit").value;
        const conversion = convertUnits(val, fromU, toU);
        const conversionResult = document.getElementById("conversionResult");
        conversionResult.innerHTML = `<p>${conversion}</p>`;
      });

      // Inicializar UI
      updateUI();
      updateHistoryUI();
    });
  </script>
</body>
</html>
