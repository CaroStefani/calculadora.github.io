<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Calculadora de Concentraciones Químicas</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: #FFFFFF; /* Fondo blanco */
    color: #333;
    text-align: center;
  }

  h1, h2, h3, h4, h5 {
    margin-top: 0.5em;
    color: #333;
  }

  label {
    display: block;
    margin-top: 5px;
    font-weight: bold;
    text-align: left; /* Mantener labels alineados a la izquierda */
  }

  input, select, button {
    margin-top: 5px;
    padding: 5px;
    width: 100%;
    max-width: 250px;
    box-sizing: border-box;
    border-radius: 3px;
    border: 1px solid #ccc;
  }

  button {
    width: auto;
    cursor: pointer;
    background-color: #f5f5f5;
    border: 1px solid #ccc;
    margin-top:10px;
  }

  .section {
    margin: 10px auto; /* Menos margen, centrado */
    padding: 10px; /* Menos padding */
    border-radius: 5px;
    border: 1px solid #ddd;
    background: #f9f9f9;
    max-width: 400px; /* Limitar el ancho para que se vea más compacto */
    text-align: left; /* Contenido alineado a la izquierda */
  }

  .section h5 {
    text-align: center; /* Títulos centrados */
  }

  .green-box {
    background: #ddffdd;
  }

  .blue-box {
    background: #ddeeff;
  }

  .yellow-box {
    background: #fffadd;
  }

  .pink-box {
    background: #ffe4e1;
  }

  .result {
    background: #ddffdd; /* Verde pastel */
    border: 1px solid #b3d7ff;
    padding: 10px;
    margin-top: 10px;
    border-radius: 5px;
    text-align:center;
  }

  .history {
    list-style: none;
    padding: 0;
  }

  .history li {
    background: #FFFADD; /* Amarillo pastel */
    margin-bottom: 5px;
    padding: 5px; /* Menos padding */
    border-radius: 5px;
    border: 1px solid #ccc;
    text-align:center;
  }

  .conversion-panel {
    margin-top: 10px;
  }

  .tutorial-step {
    background: #fff;
    border: 1px solid #ccc;
    margin-bottom:5px;
    padding: 5px;
    border-radius: 3px;
  }

  .flex-row {
    display: flex;
    flex-wrap: wrap;
    gap: 5px; /* menos espacio */
    justify-content: center; /* Centrar elementos */
  }

  .footer-message {
    margin-top: 20px;
    text-align: center;
    color: #333;
    font-style: italic;
  }
</style>
</head>
<body>
<h1>Calculadora de Concentraciones Químicas</h1>

<div class="section blue-box">
  <label for="calcType" style="text-align:center;">Seleccione el tipo de cálculo:</label>
  <select id="calcType" style="margin: 0 auto; display:block;">
    <option value="percent_m_m">% m/m (Porcentaje masa/masa)</option>
    <option value="percent_m_v">% m/v (Porcentaje masa/volumen)</option>
    <option value="percent_v_v">% v/v (Porcentaje volumen/volumen)</option>
    <option value="ppm">PPM (Partes por millón)</option>
    <option value="molarity">M (Molaridad)</option>
    <option value="normality">N (Normalidad)</option>
    <option value="mole_fraction">X (Fracción molar)</option>
  </select>
</div>

<div id="tutorial" class="section green-box" style="max-width:400px; margin:10px auto;"></div>

<h5>Datos de entrada</h5>
<div id="inputFields" class="section pink-box"></div>

<button id="calcButton">Calcular</button>

<div id="resultContainer" style="max-width:400px; margin:10px auto;"></div>

<div class="section yellow-box conversion-panel" style="max-width:400px; margin:10px auto;">
  <h5>Conversión de Unidades</h5>
  <div class="flex-row">
    <div>
      <label>Valor:</label>
      <input type="number" id="convertValue" placeholder="Valor"/>
    </div>
    <div>
      <label>De:</label>
      <select id="fromUnit">
        <option>gramos (g)</option>
        <option>kilogramos (kg)</option>
        <option>litros (L)</option>
        <option>mililitros (mL)</option>
      </select>
    </div>
    <div>
      <label>A:</label>
      <select id="toUnit">
        <option>gramos (g)</option>
        <option>kilogramos (kg)</option>
        <option>litros (L)</option>
        <option>mililitros (mL)</option>
      </select>
    </div>
  </div>
  <button id="convertButton">Convertir</button>
  <div id="conversionResult" style="text-align:center; margin-top:10px;"></div>
</div>

<h5 style="margin:10px;">Último cálculo realizado</h5>
<ul class="history" id="historyList" style="max-width:400px; margin:10px auto;"></ul>

<p class="footer-message">Trabajo desarrollado por Daniela Torreblanca y Carlolina Martínez</p>

<script>
// Tutoriales para cada tipo de cálculo
const tutorialSteps = {
  "percent_m_m": [
    "Seleccionar % m/m.",
    "Ingrese la masa del soluto (g) y la masa total (g).",
    "Fórmula: (masa soluto / masa total)*100."
  ],
  "percent_m_v": [
    "Seleccionar % m/v.",
    "Ingrese la masa del soluto (g) y el volumen de la solución (mL).",
    "Fórmula: %m/v = (masa soluto (g)/volumen disolución (mL))*100%."
  ],
  "percent_v_v": [
    "Seleccionar % v/v.",
    "Ingrese volumen del soluto y volumen total.",
    "Fórmula: (volumen soluto / volumen total)*100."
  ],
  "ppm": [
    "Seleccionar PPM.",
    "Ingrese la masa del soluto (g) y la masa total (g).",
    "Fórmula: (masa soluto/masa total)*10^6."
  ],
  "molarity": [
    "Seleccionar Molaridad (M).",
    "Ingrese moles de soluto (mol) y volumen de la solución (L).",
    "Fórmula: M = moles de soluto / L disolución."
  ],
  "normality": [
    "Seleccionar Normalidad (N).",
    "Ingrese equivalentes del soluto y volumen (L) de la solución.",
    "Fórmula: N = equivalentes soluto / L solución."
  ],
  "mole_fraction": [
    "Seleccionar Fracción molar (X).",
    "Ingrese moles soluto y moles solvente.",
    "X = moles soluto / (moles soluto + moles solvente)."
  ]
};

// Opciones de input dinámico según el tipo de cálculo
function getInputFields(type) {
  switch(type) {
    case "percent_m_m":
      return `
        <label>Masa del soluto (g): <input type="number" id="massSoluto" /></label>
        <label>Masa total de la solución (g): <input type="number" id="massTotal" /></label>
      `;
    case "percent_m_v":
      return `
        <label>Masa del soluto (g): <input type="number" id="massSoluto" /></label>
        <label>Volumen de la solución (mL): <input type="number" id="volumeSolution" /></label>
      `;
    case "percent_v_v":
      return `
        <label>Volumen del soluto: <input type="number" id="volumeSoluto" /></label>
        <label>Volumen total de la solución: <input type="number" id="volumeTotal" /></label>
      `;
    case "ppm":
      return `
        <label>Masa del soluto (g): <input type="number" id="massSoluto" /></label>
        <label>Masa total (g): <input type="number" id="massTotal" /></label>
      `;
    case "molarity":
      return `
        <label>Moles de soluto (mol): <input type="number" id="molesSoluto" /></label>
        <label>Volumen de la solución (L): <input type="number" id="volumeSolution" /></label>
      `;
    case "normality":
      return `
        <label>Equivalentes del soluto: <input type="number" id="equivalentes" /></label>
        <label>Volumen de la solución (L): <input type="number" id="volumeSolution" /></label>
      `;
    case "mole_fraction":
      return `
        <label>Moles de soluto (mol): <input type="number" id="molesSoluto" /></label>
        <label>Moles de solvente (mol): <input type="number" id="molesSolvente" /></label>
      `;
    default:
      return "";
  }
}

// Cálculos
function calculate(type, inputs) {
  let result = null;
  let explanation = "";
  const n = Number;

  switch(type) {
    case "percent_m_m":
      if (inputs.massSoluto && inputs.massTotal) {
        const val = (n(inputs.massSoluto)/n(inputs.massTotal))*100;
        result = val.toFixed(4) + " % m/m";
        explanation = "Porcentaje masa/masa = (masa soluto / masa total)*100.";
      }
      break;
    case "percent_m_v":
      if (inputs.massSoluto && inputs.volumeSolution) {
        const val = (n(inputs.massSoluto)/n(inputs.volumeSolution))*100;
        result = val.toFixed(4) + " % m/v";
        explanation = "% m/v = (g soluto/mL solución)*100.";
      }
      break;
    case "percent_v_v":
      if (inputs.volumeSoluto && inputs.volumeTotal) {
        const val = (n(inputs.volumeSoluto)/n(inputs.volumeTotal))*100;
        result = val.toFixed(4) + " % v/v";
        explanation = "% v/v = (volumen soluto/volumen total)*100.";
      }
      break;
    case "ppm":
      if (inputs.massSoluto && inputs.massTotal) {
        const val = (n(inputs.massSoluto)/n(inputs.massTotal))*1_000_000;
        result = val.toFixed(4) + " ppm";
        explanation = "PPM = (masa soluto/masa total)*10^6.";
      }
      break;
    case "molarity":
      if (inputs.molesSoluto && inputs.volumeSolution) {
        const val = n(inputs.molesSoluto)/n(inputs.volumeSolution);
        result = val.toFixed(4) + " M";
        explanation = "M = moles de soluto / L disolución.";
      }
      break;
    case "normality":
      if (inputs.equivalentes && inputs.volumeSolution) {
        const val = n(inputs.equivalentes)/n(inputs.volumeSolution);
        result = val.toFixed(4) + " N";
        explanation = "N = equivalentes soluto / L solución.";
      }
      break;
    case "mole_fraction":
      if (inputs.molesSoluto && inputs.molesSolvente) {
        const val = n(inputs.molesSoluto)/(n(inputs.molesSoluto)+n(inputs.molesSolvente));
        result = val.toFixed(4);
        explanation = "Fracción molar = moles soluto/(moles soluto + moles solvente).";
      }
      break;
  }

  return {result, explanation};
}

// Manejo de historial en localStorage
function loadHistory() {
  let hist = localStorage.getItem("lastCalculation");
  return hist ? JSON.parse(hist) : null;
}

function saveHistory(entry) {
  // Guardamos sólo el último cálculo
  localStorage.setItem("lastCalculation", JSON.stringify(entry));
}

function updateHistoryUI() {
  const h = loadHistory();
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  if (h) {
    const li = document.createElement("li");
    li.innerHTML = `<strong>${getCalcLabel(h.type)}</strong> (${h.date})<br>Inputs: ${JSON.stringify(h.inputs)}<br>Resultado: ${h.result}`;
    list.appendChild(li);
  }
}

function getCalcLabel(type) {
  const labels = {
    "percent_m_m": "% m/m",
    "percent_m_v": "% m/v",
    "percent_v_v": "% v/v",
    "ppm": "PPM",
    "molarity": "M",
    "normality": "N",
    "mole_fraction": "X (Fracción molar)"
  };
  return labels[type] || type;
}

function showTutorial(type) {
  const container = document.getElementById("tutorial");
  container.innerHTML = "";
  if (tutorialSteps[type]) {
    if (tutorialSteps[type].length > 0) {
      const title = document.createElement("h5");
      title.textContent = "Tutorial Interactivo";
      title.style.textAlign = "center";
      container.appendChild(title);
    }
    tutorialSteps[type].forEach((step, i) => {
      const div = document.createElement("div");
      div.className = "tutorial-step";
      div.textContent = "Paso " + (i+1) + ": " + step;
      container.appendChild(div);
    });
  }
}

// Manejo de conversión simple
function convertUnits(val, fromU, toU) {
  let number = parseFloat(val);
  if (isNaN(number)) return null;

  if (fromU.includes("kilogramos")) {
    number = number * 1000; // a g
  } else if (fromU.includes("gramos")) {
    // ya está en g
  } else if (fromU.includes("litros")) {
    // ya está en L
  } else if (fromU.includes("mililitros")) {
    number = number / 1000; // a L
  }

  if (toU.includes("kilogramos")) {
    if (fromU.includes("litros") || fromU.includes("mililitros")) {
      return "Conversión no definida entre volumen y masa sin densidad";
    }
    number = number / 1000; // g a kg
  } else if (toU.includes("gramos")) {
    if (fromU.includes("litros") || fromU.includes("mililitros")) {
      return "Conversión no definida entre volumen y masa sin densidad";
    }
    // ya es g
  } else if (toU.includes("litros")) {
    if (fromU.includes("gramos") || fromU.includes("kilogramos")) {
      return "Conversión no definida entre masa y volumen sin densidad";
    }
    // ya es L
  } else if (toU.includes("mililitros")) {
    if (fromU.includes("gramos") || fromU.includes("kilogramos")) {
      return "Conversión no definida entre masa y volumen sin densidad";
    }
    number = number * 1000; // L a mL
  }

  return number;
}


// Inicialización
document.addEventListener("DOMContentLoaded", () => {
  const calcTypeSelect = document.getElementById("calcType");
  const inputFieldsContainer = document.getElementById("inputFields");
  const calcButton = document.getElementById("calcButton");
  const resultContainer = document.getElementById("resultContainer");
  const convertButton = document.getElementById("convertButton");

  function updateUI() {
    const type = calcTypeSelect.value;
    inputFieldsContainer.innerHTML = getInputFields(type);
    showTutorial(type);
    resultContainer.innerHTML = "";
  }

  calcTypeSelect.addEventListener("change", updateUI);

  calcButton.addEventListener("click", () => {
    const type = calcTypeSelect.value;
    // Tomar inputs
    const inputs = {};
    const fields = inputFieldsContainer.querySelectorAll("input");
    fields.forEach(f => {
      inputs[f.id] = f.value;
    });

    const {result, explanation} = calculate(type, inputs);
    if (result) {
      resultContainer.innerHTML = `
        <div class="result">
          <h5>Resultado</h5>
          <p>${result}</p>
          <p><b>Explicación:</b> ${explanation}</p>
        </div>
      `;
      const entry = {
        type: type,
        inputs: inputs,
        result: result,
        date: new Date().toLocaleString()
      };
      saveHistory(entry);
      updateHistoryUI();
    } else {
      resultContainer.innerHTML = `<div class="result">Por favor, verifique los datos ingresados.</div>`;
    }
  });

  convertButton.addEventListener("click", () => {
    const val = document.getElementById("convertValue").value;
    const fromU = document.getElementById("fromUnit").value;
    const toU = document.getElementById("toUnit").value;
    const conversion = convertUnits(val, fromU, toU);
    const conversionResult = document.getElementById("conversionResult");
    if (conversion === null) {
      conversionResult.textContent = "Valor inválido.";
    } else if (typeof conversion === "string") {
      conversionResult.textContent = conversion;
    } else {
      conversionResult.textContent = `${val} ${fromU} = ${conversion} ${toU}`;
    }
  });

  // Inicializar UI
  updateUI();
  updateHistoryUI();
});
</script>
</body>
</html>
